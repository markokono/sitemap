function loadtoc(t){function e(){if("entry"in t.feed){var e=t.feed.entry.length;if(totalEntires+=e,totalPosts=t.feed.openSearch$totalResults.$t,totalPosts>totalEntires){var s=document.createElement("script");s.type="text/javascript",startindex=totalEntires+1,s.setAttribute("src","/feeds/posts/summary?start-index="+startindex+"&max-results=500&alt=json-in-script&callback=loadtoc"),tocdiv.appendChild(s)}for(var o=0;e>o;o++){for(var l,a=t.feed.entry[o],r=a.title.$t,i=a.published.$t.substring(0,10),n=0;n<a.link.length;n++)if("alternate"==a.link[n].rel){l=a.link[n].href;break}if("content"in a)var c=a.content.$t;else if("summary"in a)var c=a.summary.$t;else var c="";var p=/<\S[^>]*>/g;if(c=c.replace(p,""),c.length>numChars){c=c.substring(0,numChars);var d=c.lastIndexOf(" ");c=c.substring(0,d)+"..."}var f="";if("category"in a){for(var n=0;n<a.category.length;n++)f+="<a href=\"javascript:filterPosts('"+a.category[n].term+"');\" title=\"Click here to select all posts with label '"+a.category[n].term+"'\">"+a.category[n].term+"</a>,  ";var y=f.lastIndexOf(",");-1!=y&&(f=f.substring(0,y))}postTitle.push(r),postDate.push(i),postUrl.push(l),postSum.push(c),postLabels.push(f)}}totalEntires==totalPosts&&(tocLoaded=!0,showToc())}e(),sortPosts(sortBy),tocLoaded=!0}function filterPosts(t){postFilter=t,displayToc(postFilter)}function allPosts(){postFilter="",displayToc(postFilter)}function sortPosts(t){function e(t,e){var s=postTitle[t];postTitle[t]=postTitle[e],postTitle[e]=s;var s=postDate[t];postDate[t]=postDate[e],postDate[e]=s;var s=postUrl[t];postUrl[t]=postUrl[e],postUrl[e]=s;var s=postSum[t];postSum[t]=postSum[e],postSum[e]=s;var s=postLabels[t];postLabels[t]=postLabels[e],postLabels[e]=s}for(var s=0;s<postTitle.length-1;s++)for(var o=s+1;o<postTitle.length;o++)"titleasc"==t&&postTitle[s]>postTitle[o]&&e(s,o),"titledesc"==t&&postTitle[s]<postTitle[o]&&e(s,o),"dateoldest"==t&&postDate[s]>postDate[o]&&e(s,o),"datenewest"==t&&postDate[s]<postDate[o]&&e(s,o)}function displayToc(t){var e=0,s="",o="POST TITLE",l="Click to sort by title",a="POST DATE",r="Click to sort by date",i="LABELS",n="";"titleasc"==sortBy&&(l+=" (descending)",r+=" (newest first)"),"titledesc"==sortBy&&(l+=" (ascending)",r+=" (newest first)"),"dateoldest"==sortBy&&(l+=" (ascending)",r+=" (newest first)"),"datenewest"==sortBy&&(l+=" (ascending)",r+=" (oldest first)"),""!=postFilter&&(n="Click to show all posts"),s+="<table>",s+="<tr>",s+='<td class="toc-header-col1">',s+='<a href="javascript:toggleTitleSort();" title="'+l+'">'+o+"</a>",s+="</td>",s+='<td class="toc-header-col2">',s+='<a href="javascript:toggleDateSort();" title="'+r+'">'+a+"</a>",s+="</td>",s+='<td class="toc-header-col3">',s+='<a href="javascript:allPosts();" title="'+n+'">'+i+"</a>",s+="</td>",s+="</tr>";for(var c=0;c<postTitle.length;c++)""==t?(s+='<tr><td class="toc-entry-col1"><a href="'+postUrl[c]+'" title="'+postSum[c]+'">'+postTitle[c]+'</a></td><td class="toc-entry-col2">'+postDate[c]+'</td><td class="toc-entry-col3">'+postLabels[c]+"</td></tr>",e++):(z=postLabels[c].lastIndexOf(t),-1!=z&&(s+='<tr><td class="toc-entry-col1"><a href="'+postUrl[c]+'" title="'+postSum[c]+'">'+postTitle[c]+'</a></td><td class="toc-entry-col2">'+postDate[c]+'</td><td class="toc-entry-col3">'+postLabels[c]+"</td></tr>",e++));if(s+="</table>",e==postTitle.length)var p='<span class="toc-note">Displaying all '+postTitle.length+" posts<br/></span>";else{var p='<span class="toc-note">Displaying '+e+" posts labeled '";p+=postFilter+"' of "+postTitle.length+" posts total<br/></span>"}tocdiv.innerHTML=p+s}function toggleTitleSort(){sortBy="titleasc"==sortBy?"titledesc":"titleasc",sortPosts(sortBy),displayToc(postFilter)}function toggleDateSort(){sortBy="datenewest"==sortBy?"dateoldest":"datenewest",sortPosts(sortBy),displayToc(postFilter)}function showToc(){if(tocLoaded){displayToc(postFilter);document.getElementById("toclink")}else alert("Just wait... TOC is loading")}function hideToc(){var t=document.getElementById("toc");t.innerHTML="";var e=document.getElementById("toclink");e.innerHTML='<a href="#" onclick="scroll(0,0); showToc(); Effect.toggle(\'toc-result\',\'blind\');">ï¿½ Show Table of Contents</a> <img src="http://chenkaie.blog.googlepages.com/new_1.gif"/>'}var postTitle=new Array,postUrl=new Array,postDate=new Array,postSum=new Array,postLabels=new Array,sortBy="datenewest",tocLoaded=!1,numChars=250,postFilter="",tocdiv=document.getElementById("bp_toc"),totalEntires=0,totalPosts=0;
